/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Pipe } from '@angular/core';
// unsupported: template constraints.
/**
 * @template R
 */
var GtOrderByPipe = /** @class */ (function () {
    function GtOrderByPipe() {
        /**
         * Return property
         */
        this.getProperty = function (array, key) {
            for (var /** @type {?} */ i = 0; i < array.length; i++) {
                if (array[i].objectKey === key) {
                    return array[i];
                }
            }
        };
    }
    /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    GtOrderByPipe._orderByComparator = /**
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        // sort boolean values as strings
        if (typeof a === 'boolean') {
            a = a.toString();
        }
        if (typeof b === 'boolean') {
            b = b.toString();
        }
        if (isNaN(parseFloat(a)) ||
            !isFinite(a) ||
            (isNaN(parseFloat(b)) || !isFinite(b))) {
            if (b === null ||
                (typeof b === 'undefined' && (a !== null && typeof a !== 'undefined'))) {
                return 1;
            }
            if (a === null ||
                (typeof a === 'undefined' && (b !== null && typeof b !== 'undefined'))) {
                return -1;
            }
            // isn't a number so lowercase the string to properly compare
            try {
                if (a.toLowerCase() < b.toLowerCase()) {
                    return -1;
                }
                if (a.toLowerCase() > b.toLowerCase()) {
                    return 1;
                }
            }
            catch (/** @type {?} */ error) {
                return 0;
            }
        }
        else {
            // parse strings as numbers to compare properly
            if (parseFloat(a) < parseFloat(b)) {
                return -1;
            }
            if (parseFloat(a) > parseFloat(b)) {
                return 1;
            }
        }
        return 0; // equal each other
    };
    /**
     * Return sort function
     * @param {?} field
     * @return {?}
     */
    GtOrderByPipe.prototype.getSortFunction = /**
     * Return sort function
     * @param {?} field
     * @return {?}
     */
    function (field) {
        if (!field) {
            // console.log('error trying to sort undefined field');
            return false;
        }
        if (typeof field.sort === 'function') {
            return field.sort;
        }
        else if (typeof field.value === 'function') {
            return field.value;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} input
     * @param {?} sortByProperties
     * @param {?} fields
     * @param {?} refreshSorting
     * @param {?} refreshData
     * @return {?}
     */
    GtOrderByPipe.prototype.transform = /**
     * @param {?} input
     * @param {?} sortByProperties
     * @param {?} fields
     * @param {?} refreshSorting
     * @param {?} refreshData
     * @return {?}
     */
    function (input, sortByProperties, fields, refreshSorting, refreshData) {
        var _this = this;
        if (!Array.isArray(input) || input === null) {
            return input;
        }
        if (!Array.isArray(sortByProperties) ||
            (Array.isArray(sortByProperties) && sortByProperties.length === 1)) {
            var /** @type {?} */ propertyToCheck = sortByProperties[0];
            var /** @type {?} */ desc_1 = propertyToCheck.substr(0, 1) === '-';
            // basic array
            if (!propertyToCheck ||
                propertyToCheck === '-' ||
                propertyToCheck === '+') {
                return !desc_1 ? input.sort() : input.sort().reverse();
            }
            else {
                var /** @type {?} */ property_1 = propertyToCheck.substr(0, 1) === '+' ||
                    propertyToCheck.substr(0, 1) === '-'
                    ? propertyToCheck.substr(1)
                    : propertyToCheck;
                // check if custom sort function is defined
                var /** @type {?} */ sortFunction_1 = this.getSortFunction(this.getProperty(fields, property_1));
                // console.log(property);
                return input.sort(function (a, b) {
                    // use custom sort function if one is defined
                    var /** @type {?} */ propertyA = sortFunction_1 === false
                        ? property_1 === '$$gtRowId'
                            ? +a.$$gtRowId.split('_')[0]
                            : a[property_1]
                        : sortFunction_1(a);
                    var /** @type {?} */ propertyB = sortFunction_1 === false
                        ? property_1 === '$$gtRowId'
                            ? +b.$$gtRowId.split('_')[0]
                            : b[property_1]
                        : sortFunction_1(b);
                    // if both values are undefined...
                    if (typeof propertyA === 'undefined' &&
                        typeof propertyB === 'undefined') {
                        // ...skip comparison
                        return;
                    }
                    return !desc_1
                        ? GtOrderByPipe._orderByComparator(propertyA, propertyB)
                        : -GtOrderByPipe._orderByComparator(propertyA, propertyB);
                });
            }
        }
        else {
            // loop over property of the array in order and sort
            return input.sort(function (a, b) {
                // console.log('multiple');
                for (var /** @type {?} */ i = 0; i < sortByProperties.length; i++) {
                    var /** @type {?} */ desc = sortByProperties[i].substr(0, 1) === '-';
                    var /** @type {?} */ property = sortByProperties[i].substr(0, 1) === '+' ||
                        sortByProperties[i].substr(0, 1) === '-'
                        ? sortByProperties[i].substr(1)
                        : sortByProperties[i];
                    // console.log(property);
                    // check if custom sort function is defined
                    var /** @type {?} */ sortFunction = _this.getSortFunction(_this.getProperty(fields, property));
                    // use custom sort function if one is defined
                    var /** @type {?} */ propertyA = sortFunction === false
                        ? property === '$$gtRowId'
                            ? +a.$$gtRowId.split('_')[0]
                            : a[property]
                        : sortFunction(a);
                    var /** @type {?} */ propertyB = sortFunction === false
                        ? property === '$$gtRowId'
                            ? +b.$$gtRowId.split('_')[0]
                            : b[property]
                        : sortFunction(b);
                    var /** @type {?} */ comparison = !desc
                        ? GtOrderByPipe._orderByComparator(propertyA, propertyB)
                        : -GtOrderByPipe._orderByComparator(propertyA, propertyB);
                    // don't return 0 yet in case of needing to sort by next property
                    if (comparison !== 0) {
                        return comparison;
                    }
                }
                return 0; // equal each other
            });
        }
    };
    GtOrderByPipe.decorators = [
        { type: Pipe, args: [{
                    name: 'gtOrderBy'
                },] },
    ];
    return GtOrderByPipe;
}());
export { GtOrderByPipe };
function GtOrderByPipe_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    GtOrderByPipe.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    GtOrderByPipe.ctorParameters;
    /**
     * Return property
     * @type {?}
     */
    GtOrderByPipe.prototype.getProperty;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3Qtb3JkZXItYnkucGlwZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bhbmd1bGFyLWdlbmVyaWMtdGFibGUvY29yZS8iLCJzb3VyY2VzIjpbInBpcGVzL2d0LW9yZGVyLWJ5LnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7OzJCQTREN0IsVUFBUyxLQUFpQixFQUFFLEdBQVc7WUFDNUQsS0FBSyxxQkFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUN0QyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEtBQUssR0FBRyxFQUFFO29CQUMvQixPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDaEI7YUFDRDtTQUNEOzs7Ozs7O0lBMURNLGdDQUFrQjs7Ozs7SUFBekIsVUFBMEIsQ0FBTSxFQUFFLENBQU07O1FBRXZDLElBQUksT0FBTyxDQUFDLEtBQUssU0FBUyxFQUFFO1lBQzNCLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDakI7UUFDRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLFNBQVMsRUFBRTtZQUMzQixDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2pCO1FBRUQsSUFDQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNaLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ3JDO1lBQ0QsSUFDQyxDQUFDLEtBQUssSUFBSTtnQkFDVixDQUFDLE9BQU8sQ0FBQyxLQUFLLFdBQVcsSUFBSSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksT0FBTyxD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QVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM1QixDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQzt3QkFDZCxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUVwQixxQkFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFJO3dCQUN2QixDQUFDLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7d0JBQ3hELENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7O29CQUczRCxJQUFJLFVBQVUsS0FBSyxDQUFDLEVBQUU7d0JBQ3JCLE9BQU8sVUFBVSxDQUFDO3FCQUNsQjtpQkFDRDtnQkFFRCxPQUFPLENBQUMsQ0FBQzthQUNULENBQUMsQ0FBQztTQUNIO0tBQ0Q7O2dCQTdMRCxJQUFJLFNBQUM7b0JBQ0wsSUFBSSxFQUFFLFdBQVc7aUJBQ2pCOzt3QkFORDs7U0FPYSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBHdENvbmZpZ0ZpZWxkIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9ndC1jb25maWctZmllbGQnO1xyXG5pbXBvcnQgeyBHdFJvdyB9IGZyb20gJy4uL2ludGVyZmFjZXMvZ3Qtcm93JztcclxuXHJcbkBQaXBlKHtcclxuXHRuYW1lOiAnZ3RPcmRlckJ5J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgR3RPcmRlckJ5UGlwZTxSIGV4dGVuZHMgR3RSb3c+IGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcblx0c3RhdGljIF9vcmRlckJ5Q29tcGFyYXRvcihhOiBhbnksIGI6IGFueSk6IG51bWJlciB7XHJcblx0XHQvLyBzb3J0IGJvb2xlYW4gdmFsdWVzIGFzIHN0cmluZ3NcclxuXHRcdGlmICh0eXBlb2YgYSA9PT0gJ2Jvb2xlYW4nKSB7XHJcblx0XHRcdGEgPSBhLnRvU3RyaW5nKCk7XHJcblx0XHR9XHJcblx0XHRpZiAodHlwZW9mIGIgPT09ICdib29sZWFuJykge1xyXG5cdFx0XHRiID0gYi50b1N0cmluZygpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChcclxuXHRcdFx0aXNOYU4ocGFyc2VGbG9hdChhKSkgfHxcclxuXHRcdFx0IWlzRmluaXRlKGEpIHx8XHJcblx0XHRcdChpc05hTihwYXJzZUZsb2F0KGIpKSB8fCAhaXNGaW5pdGUoYikpXHJcblx0XHQpIHtcclxuXHRcdFx0aWYgKFxyXG5cdFx0XHRcdGIgPT09IG51bGwgfHxcclxuXHRcdFx0XHQodHlwZW9mIGIgPT09ICd1bmRlZmluZWQnICYmIChhICE9PSBudWxsICYmIHR5cGVvZiBhICE9PSAndW5kZWZpbmVkJykpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdHJldHVybiAxO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHRhID09PSBudWxsIHx8XHJcblx0XHRcdFx0KHR5cGVvZiBhID09PSAndW5kZWZpbmVkJyAmJiAoYiAhPT0gbnVsbCAmJiB0eXBlb2YgYiAhPT0gJ3VuZGVmaW5lZCcpKVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRyZXR1cm4gLTE7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIGlzbid0IGEgbnVtYmVyIHNvIGxvd2VyY2FzZSB0aGUgc3RyaW5nIHRvIHByb3Blcmx5IGNvbXBhcmVcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRpZiAoYS50b0xvd2VyQ2FzZSgpIDwgYi50b0xvd2VyQ2FzZSgpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gLTE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChhLnRvTG93ZXJDYXNlKCkgPiBiLnRvTG93ZXJDYXNlKCkpIHtcclxuXHRcdFx0XHRcdHJldHVybiAxO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcclxuXHRcdFx0XHRyZXR1cm4gMDtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Ly8gcGFyc2Ugc3RyaW5ncyBhcyBudW1iZXJzIHRvIGNvbXBhcmUgcHJvcGVybHlcclxuXHRcdFx0aWYgKHBhcnNlRmxvYXQoYSkgPCBwYXJzZUZsb2F0KGIpKSB7XHJcblx0XHRcdFx0cmV0dXJuIC0xO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChwYXJzZUZsb2F0KGEpID4gcGFyc2VGbG9hdChiKSkge1xyXG5cdFx0XHRcdHJldHVybiAxO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIDA7IC8vIGVxdWFsIGVhY2ggb3RoZXJcclxuXHR9XHJcblxyXG5cdC8qKiBSZXR1cm4gcHJvcGVydHkgKi9cclxuXHRwcml2YXRlIGdldFByb3BlcnR5ID0gZnVuY3Rpb24oYXJyYXk6IEFycmF5PGFueT4sIGtleTogc3RyaW5nKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmIChhcnJheVtpXS5vYmplY3RLZXkgPT09IGtleSkge1xyXG5cdFx0XHRcdHJldHVybiBhcnJheVtpXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdC8qKiBSZXR1cm4gc29ydCBmdW5jdGlvbiAqL1xyXG5cdHByaXZhdGUgZ2V0U29ydEZ1bmN0aW9uKGZpZWxkOiBhbnkpIHtcclxuXHRcdGlmICghZmllbGQpIHtcclxuXHRcdFx0Ly8gY29uc29sZS5sb2coJ2Vycm9yIHRyeWluZyB0byBzb3J0IHVuZGVmaW5lZCBmaWVsZCcpO1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRpZiAodHlwZW9mIGZpZWxkLnNvcnQgPT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0cmV0dXJuIGZpZWxkLnNvcnQ7XHJcblx0XHR9IGVsc2UgaWYgKHR5cGVvZiBmaWVsZC52YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG5cdFx0XHRyZXR1cm4gZmllbGQudmFsdWU7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR0cmFuc2Zvcm0oXHJcblx0XHRpbnB1dDogYW55LFxyXG5cdFx0c29ydEJ5UHJvcGVydGllczogQXJyYXk8c3RyaW5nPixcclxuXHRcdGZpZWxkczogR3RDb25maWdGaWVsZDxSLCBhbnk+W10sXHJcblx0XHRyZWZyZXNoU29ydGluZzogYm9vbGVhbixcclxuXHRcdHJlZnJlc2hEYXRhOiBudW1iZXJcclxuXHQpOiBhbnkge1xyXG5cdFx0aWYgKCFBcnJheS5pc0FycmF5KGlucHV0KSB8fCBpbnB1dCA9PT0gbnVsbCkge1xyXG5cdFx0XHRyZXR1cm4gaW5wdXQ7XHJcblx0XHR9XHJcblx0XHRpZiAoXHJcblx0XHRcdCFBcnJheS5pc0FycmF5KHNvcnRCeVByb3BlcnRpZXMpIHx8XHJcblx0XHRcdChBcnJheS5pc0FycmF5KHNvcnRCeVByb3BlcnRpZXMpICYmIHNvcnRCeVByb3BlcnRpZXMubGVuZ3RoID09PSAxKVxyXG5cdFx0KSB7XHJcblx0XHRcdGNvbnN0IHByb3BlcnR5VG9DaGVjazogc3RyaW5nID0gc29ydEJ5UHJvcGVydGllc1swXTtcclxuXHRcdFx0Y29uc3QgZGVzYyA9IHByb3BlcnR5VG9DaGVjay5zdWJzdHIoMCwgMSkgPT09ICctJztcclxuXHJcblx0XHRcdC8vIGJhc2ljIGFycmF5XHJcblx0XHRcdGlmIChcclxuXHRcdFx0XHQhcHJvcGVydHlUb0NoZWNrIHx8XHJcblx0XHRcdFx0cHJvcGVydHlUb0NoZWNrID09PSAnLScgfHxcclxuXHRcdFx0XHRwcm9wZXJ0eVRvQ2hlY2sgPT09ICcrJ1xyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRyZXR1cm4gIWRlc2MgPyBpbnB1dC5zb3J0KCkgOiBpbnB1dC5zb3J0KCkucmV2ZXJzZSgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGNvbnN0IHByb3BlcnR5OiBzdHJpbmcgPVxyXG5cdFx0XHRcdFx0cHJvcGVydHlUb0NoZWNrLnN1YnN0cigwLCAxKSA9PT0gJysnIHx8XHJcblx0XHRcdFx0XHRwcm9wZXJ0eVRvQ2hlY2suc3Vic3RyKDAsIDEpID09PSAnLSdcclxuXHRcdFx0XHRcdFx0PyBwcm9wZXJ0eVRvQ2hlY2suc3Vic3RyKDEpXHJcblx0XHRcdFx0XHRcdDogcHJvcGVydHlUb0NoZWNrO1xyXG5cclxuXHRcdFx0XHQvLyBjaGVjayBpZiBjdXN0b20gc29ydCBmdW5jdGlvbiBpcyBkZWZpbmVkXHJcblx0XHRcdFx0Y29uc3Qgc29ydEZ1bmN0aW9uOiBhbnkgPSB0aGlzLmdldFNvcnRGdW5jdGlvbihcclxuXHRcdFx0XHRcdHRoaXMuZ2V0UHJvcGVydHkoZmllbGRzLCBwcm9wZXJ0eSlcclxuXHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHQvLyBjb25zb2xlLmxvZyhwcm9wZXJ0eSk7XHJcblx0XHRcdFx0cmV0dXJuIGlucHV0LnNvcnQoZnVuY3Rpb24oYTogYW55LCBiOiBhbnkpIHtcclxuXHRcdFx0XHRcdC8vIHVzZSBjdXN0b20gc29ydCBmdW5jdGlvbiBpZiBvbmUgaXMgZGVmaW5lZFxyXG5cdFx0XHRcdFx0Y29uc3QgcHJvcGVydHlBID1cclxuXHRcdFx0XHRcdFx0c29ydEZ1bmN0aW9uID09PSBmYWxzZVxyXG5cdFx0XHRcdFx0XHRcdD8gcHJvcGVydHkgPT09ICckJGd0Um93SWQnXHJcblx0XHRcdFx0XHRcdFx0XHQ/ICthLiQkZ3RSb3dJZC5zcGxpdCgnXycpWzBdXHJcblx0XHRcdFx0XHRcdFx0XHQ6IGFbcHJvcGVydHldXHJcblx0XHRcdFx0XHRcdFx0OiBzb3J0RnVuY3Rpb24oYSk7XHJcblx0XHRcdFx0XHRjb25zdCBwcm9wZXJ0eUIgPVxyXG5cdFx0XHRcdFx0XHRzb3J0RnVuY3Rpb24gPT09IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0PyBwcm9wZXJ0eSA9PT0gJyQkZ3RSb3dJZCdcclxuXHRcdFx0XHRcdFx0XHRcdD8gK2IuJCRndFJvd0lkLnNwbGl0KCdfJylbMF1cclxuXHRcdFx0XHRcdFx0XHRcdDogYltwcm9wZXJ0eV1cclxuXHRcdFx0XHRcdFx0XHQ6IHNvcnRGdW5jdGlvbihiKTtcclxuXHJcblx0XHRcdFx0XHQvLyBpZiBib3RoIHZhbHVlcyBhcmUgdW5kZWZpbmVkLi4uXHJcblx0XHRcdFx0XHRpZiAoXHJcblx0XHRcdFx0XHRcdHR5cGVvZiBwcm9wZXJ0eUEgPT09ICd1bmRlZmluZWQnICYmXHJcblx0XHRcdFx0XHRcdHR5cGVvZiBwcm9wZXJ0eUIgPT09ICd1bmRlZmluZWQnXHJcblx0XHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdFx0Ly8gLi4uc2tpcCBjb21wYXJpc29uXHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHJldHVybiAhZGVzY1xyXG5cdFx0XHRcdFx0XHQ/IEd0T3JkZXJCeVBpcGUuX29yZGVyQnlDb21wYXJhdG9yKHByb3BlcnR5QSwgcHJvcGVydHlCKVxyXG5cdFx0XHRcdFx0XHQ6IC1HdE9yZGVyQnlQaXBlLl9vcmRlckJ5Q29tcGFyYXRvcihwcm9wZXJ0eUEsIHByb3BlcnR5Qik7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdC8vIGxvb3Agb3ZlciBwcm9wZXJ0eSBvZiB0aGUgYXJyYXkgaW4gb3JkZXIgYW5kIHNvcnRcclxuXHRcdFx0cmV0dXJuIGlucHV0LnNvcnQoKGE6IGFueSwgYjogYW55KSA9PiB7XHJcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ211bHRpcGxlJyk7XHJcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0QnlQcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRjb25zdCBkZXNjID0gc29ydEJ5UHJvcGVydGllc1tpXS5zdWJzdHIoMCwgMSkgPT09ICctJztcclxuXHRcdFx0XHRcdGNvbnN0IHByb3BlcnR5ID1cclxuXHRcdFx0XHRcdFx0c29ydEJ5UHJvcGVydGllc1tpXS5zdWJzdHIoMCwgMSkgPT09ICcrJyB8fFxyXG5cdFx0XHRcdFx0XHRzb3J0QnlQcm9wZXJ0aWVzW2ldLnN1YnN0cigwLCAxKSA9PT0gJy0nXHJcblx0XHRcdFx0XHRcdFx0PyBzb3J0QnlQcm9wZXJ0aWVzW2ldLnN1YnN0cigxKVxyXG5cdFx0XHRcdFx0XHRcdDogc29ydEJ5UHJvcGVydGllc1tpXTtcclxuXHJcblx0XHRcdFx0XHQvLyBjb25zb2xlLmxvZyhwcm9wZXJ0eSk7XHJcblx0XHRcdFx0XHQvLyBjaGVjayBpZiBjdXN0b20gc29ydCBmdW5jdGlvbiBpcyBkZWZpbmVkXHJcblx0XHRcdFx0XHRjb25zdCBzb3J0RnVuY3Rpb246IGFueSA9IHRoaXMuZ2V0U29ydEZ1bmN0aW9uKFxyXG5cdFx0XHRcdFx0XHR0aGlzLmdldFByb3BlcnR5KGZpZWxkcywgcHJvcGVydHkpXHJcblx0XHRcdFx0XHQpO1xyXG5cclxuXHRcdFx0XHRcdC8vIHVzZSBjdXN0b20gc29ydCBmdW5jdGlvbiBpZiBvbmUgaXMgZGVmaW5lZFxyXG5cdFx0XHRcdFx0Y29uc3QgcHJvcGVydHlBID1cclxuXHRcdFx0XHRcdFx0c29ydEZ1bmN0aW9uID09PSBmYWxzZVxyXG5cdFx0XHRcdFx0XHRcdD8gcHJvcGVydHkgPT09ICckJGd0Um93SWQnXHJcblx0XHRcdFx0XHRcdFx0XHQ/ICthLiQkZ3RSb3dJZC5zcGxpdCgnXycpWzBdXHJcblx0XHRcdFx0XHRcdFx0XHQ6IGFbcHJvcGVydHldXHJcblx0XHRcdFx0XHRcdFx0OiBzb3J0RnVuY3Rpb24oYSk7XHJcblx0XHRcdFx0XHRjb25zdCBwcm9wZXJ0eUIgPVxyXG5cdFx0XHRcdFx0XHRzb3J0RnVuY3Rpb24gPT09IGZhbHNlXHJcblx0XHRcdFx0XHRcdFx0PyBwcm9wZXJ0eSA9PT0gJyQkZ3RSb3dJZCdcclxuXHRcdFx0XHRcdFx0XHRcdD8gK2IuJCRndFJvd0lkLnNwbGl0KCdfJylbMF1cclxuXHRcdFx0XHRcdFx0XHRcdDogYltwcm9wZXJ0eV1cclxuXHRcdFx0XHRcdFx0XHQ6IHNvcnRGdW5jdGlvbihiKTtcclxuXHJcblx0XHRcdFx0XHRjb25zdCBjb21wYXJpc29uID0gIWRlc2NcclxuXHRcdFx0XHRcdFx0PyBHdE9yZGVyQnlQaXBlLl9vcmRlckJ5Q29tcGFyYXRvcihwcm9wZXJ0eUEsIHByb3BlcnR5QilcclxuXHRcdFx0XHRcdFx0OiAtR3RPcmRlckJ5UGlwZS5fb3JkZXJCeUNvbXBhcmF0b3IocHJvcGVydHlBLCBwcm9wZXJ0eUIpO1xyXG5cclxuXHRcdFx0XHRcdC8vIGRvbid0IHJldHVybiAwIHlldCBpbiBjYXNlIG9mIG5lZWRpbmcgdG8gc29ydCBieSBuZXh0IHByb3BlcnR5XHJcblx0XHRcdFx0XHRpZiAoY29tcGFyaXNvbiAhPT0gMCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gY29tcGFyaXNvbjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHJldHVybiAwOyAvLyBlcXVhbCBlYWNoIG90aGVyXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4iXX0=